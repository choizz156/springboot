## 1. JAR(Java Archive)
- 자바는 여러 클래스와 리소스를 묶어 jar라고하는 압축 파일을 만들 수 있음
- jvm 위에서 직접 실행되거나 라이브러리로 제공될 수 있음
- 직접 실행하는 경우 
	- main 메서드가 필요하고 
	- MANIFEST.MF 파일에 실행할 메인 메서드가 있는 클래스를 지정해야함
---
## 2. 서블릿 컨테이너 초기화 1
- WAS를 실행하는 시점에 필요한 초기화 작업
	- 서비스에 필요한 필터와 서블릿 등록
	- 스프링 컨테이너 생성
	- 서블릿과 스프링을 연결하는 dispatcher servlet 등록
- WAS가 제공하는 초기화 기능을 사용하면, 초기화 과정을 진행할 수 있음

**ServletContainerInitiailzer**
```java
public interface ServletContainerInitializer {     
public void onStartup(Set<Class<?>> c, ServletContext ctx) throws 
ServletException; 
}
```
`Set<Class<?>>`: 유연한 초기화 기능 제공, @HandlesTypes와 함께 사용됨
`ServletContext` : 서블릿 컨테이너 자체의 기능을 제공, 이 객체를 통해 필터나 서블릿 등록

was에 실행할 초기화 클래스를 알려줘야함
> resources/META-INF/services/jakarta.servlet.ServletContainerInitializer
```
me.container.ContainerInitV1 // ServletContainerInitializer 구현 클래스
```

---
## 3. 애플리케이션 초기화
애플리케이션 초기화를 진행하려면 인터페이스를 꼭 만들어야 함
### 3.1 서블릿 등록
#### 프로그래밍 방식
- 서블릿을 직접 등록
- 애노테이션 방식보다 유연하게 변경 가능
```java
//AppInit -> 만든 인터페이스
public class AppInitV1 implements AppInit{
	
	@Overide
	public void onStartup(ServletContext sc){
		ServletRegistration.Dynamic helloServlet = 
			sc.addServlet("helloServlet", new HelloServlet());
		helloServlet.addMapping("/hello-servlet);	
	}
}
```

#### 애노테이션 방식
```java
@WebServlet(urlPatterns = "/test") 
public class TestServlet extends HttpServlet {}
```

### 3.2 애플리케이션 초기화 과정
```java
@HandlesTypes(AppInit.class)
public class ContainerInit implements ServletContainerInitializer {

	@Override
	public void onStratup(Set<Class<?>> c, ServletContext ctx) throws ServeletException{
		
		for(Class<?> appInitClass : c){
			try{
				AppInit appInit = (AppInit) appInitClass.getDeclaredConstructor().newInstance();
				appInit.onStartup(ctx);
			}catch (Exception e){
				throws new RuntimeException(e);
			}
		}
		
	}
	
}
```


- @HandlesTypes에 초기화 인터페이스 지정
- `Set<Class<?>>` c에 애플리케이션 초기화 인터페이스의 구현체들을 모두 찾아서 클래스 정보로 전달
- 리플렉션을 사용해서 객체를 생성
- 초기화 코드를 실행하면서 서블릿 컨테이너 정보(ctx)도 함께 전달

#### 애플리케이션 초기화 개념을 만든 이유
**편리함**
- 서블릿 컨테이너 초기화를 하려면 ServletContainerInitializer 인터페이스를 구현한 후 따로 파일에 지정해줘야 함
- 애플리케이션 초기화는 특정 인터페이스만 구현하면  ServletContainerInitializer 인터페이스를 구현할 필요 없음
**의존성**
- 애플리케이션 초기화는 서블릿 컨테이너에 상관없이 원하는 모양으로 인터페이스를 만들 수 있음
   -> 애플리케이션 초기화 코드가 서블릿 컨테이너에 대한 의존을 줄일 수 있음
- ServletContext ctx 가 필요없는 애플리케이션 초기화 코드라면 의존을 완전히 제거할 수도 있음.
---
## 4. 스프링 컨테이너 등록
애플리케이션 초기화를 사용해서 서블릿 컨테이너에 스프링 컨테이너를 생성하고 등록
```java
public class AppInit3 implements AppInit{
	
	@Override
	public void onStartup(ServletContext sc){
		
		//스프링 컨테이너 생성
		AnnotationConfigWebApplicationContext appContext = new AnnotationConfigWebApplicationContext();
		appContext.register(HelloConfig.class);// 스프링 설정 추가
		
		//스프링 mvc 디스패치 서블릿 생성, 스프링 컨테이너 연결
		DispatcherServlet dispatcher = new DispatcherServlet(appContext);
		
		//디스패처 서블릿을 서블릿 컨테이너에 등록
		ServletRegistration.Dynamic servlet = sc.addServlet("dispatcherV2", dispatcher);
		
		servlet.addMapping?("/spring/*");
	}
}
```

---
## 5. 스프링 MVC 서블릿 컨테이너 초기화 지원
- 스프링 MVC는 서블릿 컨테이너 초기화 작업을 이미 만들어 둠
- 애플리케이션 초기화 코드만 작성하면 됨
```java
public interface WebApplicationInitializer{
	void onStartup(ServletContext servletContext) throws ServletException;
}
```

```java
public class AppInit3 implements WebApplicationInitializer{
	
	@Override
	public void onStartup(ServletContext servletContext){
		
		//스프링 컨테이너 생성
		AnnotationConfigWebApplicationContext appContext = new AnnotationConfigWebApplicationContext();
		appContext.register(HelloConfig.class);// 스프링 설정 추가
		
		//스프링 mvc 디스패치 서블릿 생성, 스프링 컨테이너 연결
		DispatcherServlet dispatcher = new DispatcherServlet(appContext);
		
		//디스패처 서블릿을 서블릿 컨테이너에 등록
		ServletRegistration.Dynamic servlet = servletContext.addServlet("dispatcherV3", dispatcher);
		
		servlet.addMapping?("/spring/*");
	}
}
```

### 스프링 초기화 분석
- spring-web 라이브러리를 열어보면 서블릿 컨테이너 초기화를 위한 등록 파일을 확인 가능
	- 스프링도 결국 서블릿 컨테이너에서 요구하는 부분을 모두 구현해야 함
> /META-INF/services/jakarta.servlet.ServletContainerInitializer
```
org.springframework.web.SpringServletContainerInitializer
```
**SpringServletContainerInitializer**
```java
@HandlesTypes(WebApplicationInitializer.class) 
public class SpringServletContainerInitializer implements ServletContainerInitializer {}
```